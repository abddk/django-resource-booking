{% extends 'index.html' %}
{% load staticfiles %}
{% load booking_tags %}
{% load i18n %}
{% load booking_tags %}

{% block htmltitle %} - {{ object.visit.product.title }} - {{ object.visit.date_display }} - {% blocktrans with id=object.id %}Booking #{{ id }}{% endblocktrans %}{% endblock %}

{% block content %}

    {% include 'common/breadcrumbrow.html' %}

    <div class="row titlebar hidden-print">
        <div class="col-sm-12 col-md-9">
            <h1>{% blocktrans with id=object.id %}Booking #{{ id }}{% endblocktrans %}</h1>
        </div>
        <div class="divider"></div>
    </div>
    <div class="row">
        <div class="col-sm-12 col-md-8">
        
            <div class="panel panel-default">
                <div class="panel-body">
                    {% url 'product-view' object.visit.product.id as producturl %}
                    {% url 'visit-view' object.visit.id as visiturl %}
                    {% blocktrans with firstname=object.booker.firstname lastname=object.booker.lastname producttitle=object.product.title visittime=object.visit.start_datetime %}
                        <strong>{{ firstname }} {{ lastname }}</strong> har tilmeldt sig <a href="{{ producturl }}">{{ producttitle }}</a> med afvikling <a href="{{ visiturl }}">{{ visittime }}</a>
                    {% endblocktrans %}
                    {% if object.is_waiting %}
                        <br/>
                        {% blocktrans with spot=object.waitinglist_spot %}Står på venteliste som nr {{ spot }}{% endblocktrans %}
                    {% endif %}
                </div>

            </div>

            {% if can_notify %}
                <div class="pull-right dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="sendNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {% trans 'Send besked' %}
                        <span class="caret"/>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="sendNotification">
                        <li><a data-toggle="modal" data-target="#modalhost" data-modal-href="{% url 'booking-notify' object.pk %}">{% trans 'Ingen skabelon' %}</a></li>
                        {% if emailtemplates %}
                            <li role="separator" class="divider"></li>
                            {% for id, label in emailtemplates %}
                                <li>
                                    {% if modal %}
                                        <a data-toggle="modal" data-target="#modalhost" data-modal-href="{% url 'booking-notify' object.pk %}?template={{ id }}">{{ label }}</a>
                                    {% else %}
                                        <a href="{% url 'booking-notify' object.pk %}?template={{ id }}&back={{ request.get_full_path | urlencode }}">{{ label }}</a>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        {% endif %}
                        <li role="separator" class="divider"></li>
                        <li><a href="{% url 'emailtemplate-list' %}" target="_blank">{% trans 'Redigér skabeloner' %}</a></li>
                    </ul>
                </div>
            {% endif %}


            <h2>{% trans 'Information om tilmeldingen' %}</h2>

            <dl class="dl-horizontal wide">

                <dt>{% trans 'Navn:' %}</dt>
                <dd>{{ object.booker.firstname }} {{ object.booker.lastname }}</dd>

                <dt>{% trans 'Email:' %}</dt>
                <dd>{{ object.booker.email }}</dd>

                <dt>{% trans 'Telefon:' %}</dt>
                <dd>{{ object.booker.phone }}</dd>

                <dt>{% trans 'Skole:' %}</dt>
                <dd>{{ object.booker.school.name }}, {{ object.booker.school.postcode.number }} {{ object.booker.school.postcode.city }}</dd>

                <dt>{% trans 'Retning:' %}</dt>
                <dd>
                    {{ object.booker.get_line_display }}
                </dd>

                {% if object.get_subjects %}
                <dt>{% trans 'Fag:' %}</dt>
                <dd>
                    <ul class="list-unstyled">
                        {% for fag in object.get_subjects %}
                        <li>{{ fag }}</li>
                        {% endfor %}
                    </ul>
                </dd>
                {% endif %}

                <dt>{% trans 'Niveau:' %}</dt>
                <dd>
                    {{ object.booker.get_level_display }}
                </dd>

                <dt>{% trans 'Antal deltagere:' %}</dt>
                <dd>{{ object.booker.attendee_count }}</dd>

                <dt>{% trans 'Kommentar:' %}</dt>
                <dd>{{ object.notes }}</dd>

                {% if object.classbooking %}
                    <dt>{% trans 'Rundvisning:' %}</dt>
                    <dd>{{ object.classbooking.tour_desired | yesno }}</dd>
                {% endif %}

                {% if object.classbooking %}
                    <dt>{% trans 'Forplejning:' %}</dt>
                    <dd>{{ object.classbooking.catering_desired | yesno }}</dd>
                {% endif %}

                {% if object.classbooking %}
                    <dt>{% trans 'Oplæg om uddannelse:' %}</dt>
                    <dd>{{ object.classbooking.presentation_desired | yesno }}</dd>
                {% endif %}

                {% if object.classbooking and object.product.custom_available and object.product.custom_name %}
                    <dt>{{ object.product.custom_name }}</dt>
                    <dd>{{ object.classbooking.custom_desired | yesno }}</dd>
                {% endif %}

                {% if object.teacherbooking %}
                    {% if object.teacherbooking.subjects %}
                        <dt>{% trans 'Fag:' %}</dt>
                        {% for subject in object.teacherbooking.subjects.all %}
                            <dd>
                                {{ subject }}
                            </dd>
                        {% endfor %}
                    {% endif %}
                {% endif %}

                {% if object.bookinggymnasiesubjectlevel_set.count or object.bookinggrundskolesubjectlevel_set.count %}
                    <dt>{% trans 'Fag:' %}</dt>
                    {% for subject in object.bookinggymnasiesubjectlevel_set.all %}
                        <dd>
                            {{ subject.display_value }}
                        </dd>
                    {% endfor %}
                    {% for subject in object.bookinggrundskolesubjectlevel_set.all %}
                        <dd>
                            {{ subject.display_value }}
                        </dd>
                    {% endfor %}
                {% endif %}

            </dl>

            <div class="divider"></div>

            <div class="go-back">
                <a href="{% url 'visit-search' %}" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span> {% trans 'Søg i besøg' %}</a>
            </div>
        </div>
        <div class="col-sm-6 col-md-4">
            <form class="form-horizontal">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">{% trans 'Detaljer om tilbuddet' %}</h3>
                    </div>
                    <div class="panel-body">
                        <dl class="dl-horizontal">

                            {% if object.product.title %}
                                <dt>{% trans 'Titel:' %}</dt>
                                <dd><a href="{% url 'product-view' object.visit.product.id %}">{{ object.product.title }}</a></dd>
                            {% endif %}

                            {% if object.visit.start_datetime %}
                                <dt>{% trans 'Tidspunkt:' %}</dt>
                                <dd><a href="{% url 'visit-view' object.visit.id %}">{{ object.visit.start_datetime }}</a></dd>
                            {% endif %}

                            {% if object.product.get_audience_display %}
                                <dt>{% trans 'Henvendt til:' %}</dt>
                                <dd>{{ object.product.get_audience_display }}</dd>
                            {% endif %}

                            {% if object.product.resource_ptr.all_subjects  %}
                                <dt>{% trans 'Fag/niveau:' %}</dt>
                                <dd>
                                    <ul class="type-offer list-inline">
                                        {% for x in object.product.resource_ptr.all_subjects %}
                                            <li>{{ x.display_value }}</li>
                                        {% endfor %}
                                    </ul>
                                </dd>
                            {% endif %}

                            {% if object.product.num_of_participants_display %}
                                <dt>{% trans 'Max antal:' %}</dt>
                                <dd>{{ object.product.num_of_participants_display }}</dd>
                            {% endif %}

                            {% if object.product.get_type_display %}
                                <dt>{% trans 'Hvad:' %}</dt>
                                <dd>{{ object.product.get_type_display }}</dd>
                            {% endif %}

                            {% if object.product.locality %}
                                <dt>{% trans 'Hvor:' %}</dt>
                                <dd>
                                    {{ object.product.locality.name }},<br/>
                                    {{ object.product.locality.address_line }},<br/>
                                    {{ object.product.locality.zip_city }}
                                </dd>
                            {% endif %}

                            <dt>{% trans 'Arrangør:' %}</dt>
                            <dd>
                                {% if object.product.organizationalunit.url %}
                                    <a href="{{ object.product.organizationalunit.url }}" target="_blank">
                                {% endif %}
                                <strong>{{ object.product.organizationalunit.name }}</strong>
                                {% if object.product.organizationalunit.url %}
                                    </a> <span class="glyphicon glyphicon-new-window"></span>
                                {% endif %}
                            </dd>

                            {% if object.product.duration and object.product.duration != '00:00' %}
                                <dt>{% trans 'Varighed:' %}</dt>
                                <dd>{{ object.product.duration|timedelta_i18n }}</dd>
                            {% endif %}

                            {% if object.product.price %}
                                <dt>{% trans 'Pris:' %}</dt>
                                <dd>{{ object.product.price }}</dd>
                            {% endif %}

                        </dl>
                    </div>
                </div>

                {% include 'common/map.html' with locality=object.product.locality %}
            </form>
        </div>
    </div>

    {% include 'common/modal_contact.html' %}
    {% include 'common/modal_framehost.html' %}

{% endblock %}

{% block extra_scripts %}
    <script src="{% static 'js/custom.js' %}"></script>
    <script src="{% static "js/modalframe-host.js" %}"></script>
{% endblock %}
