{% extends 'index.html' %}
{% load staticfiles %}
{% load timedelta %}
{% load i18n %}

{% block content %}

    {% include 'common/breadcrumbrow.html' %}

    <div class="row titlebar hidden-print">
        <div class="col-sm-12 col-md-9"><h2>{% trans 'Om tilbuddet' %}</h2></div>
        <div class="divider"></div>
    </div>
    <div class="row">
        <div class="col-sm-12 col-md-8">

            {% include 'common/searchform.html' %}

            <div class="divider"></div>
            <h2>{{ object.get_type_display }}</h2>
            
            {% if can_edit %}
                <a class="pull-right btn btn-primary edit-btn" href="{% url 'visit-edit' object.pk %}?back={{ thisurl | urlencode }}">+ Redigér</a>
            {% endif %}
            {% if user.userprofile.can_create %}
                <a class="pull-right btn btn-primary margin-right-10" href="{% url 'visit-clone' object.pk %}?back={{ thisurl | urlencode }}">Opret kopi</a>
            {% endif %}

            {% if can_edit %}
                <div class="pull-right dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="sendNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {% trans 'Send besked' %}
                        <span class="caret"/>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="sendNotification">
                        <li><a href="{% url 'visit-notify' object.pk %}?back={{ thisurl | urlencode }}">{% trans 'Ingen skabelon' %}</a></li>
                        {% if EmailTemplate.key_choices %}
                            <li role="separator" class="divider"></li>
                            {% for id, label in EmailTemplate.visit_key_choices %}
                                <li><a href="{% url 'visit-notify' object.pk %}?template={{ id }}&back={{ thisurl | urlencode }}">{{ label }}</a></li>
                            {% endfor %}
                        {% endif %}
                    </ul>
                </div>
            {% endif %}
            
            <h1>{{ object.title }}</h1>
            <div class="well">
                {% autoescape off %}
                {{ object.teaser }}
                {% endautoescape %}
            </div>
            <div class="well">
                <!-- Richtext editor start -->
                {% autoescape off %}
                {{ object.description }}
                {% endautoescape %}
                <!-- Richtext editor end -->
            </div>
            <div class="well order-buttons hidden-print">
                {% if can_book %}
                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#startbooking">
                    {% trans 'Tilmeld' %}
                    <span class="glyphicon glyphicon-chevron-right"></span>
                </button>
                {% endif %}
                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#kontaktformular">
                    {% trans 'Spørg om tilbud' %}
                    <span class="glyphicon glyphicon-question-sign"></span>
                </button>
            </div>
            {% if can_book %}
            <div class="disclaimer">{% trans 'Bemærk at din bestilling først er bindende, når du har modtaget en bekræftelse fra den ansvarlige arrangør fra Københavns Universitet.' %}</div>
            {% endif %}
            <div class="go-back">
                <a href="#" class="btn btn-default" onclick="history.go(-1); return false;"><span class="glyphicon glyphicon-chevron-left"></span> {% trans 'Tilbage til søgeresultat' %}</a>
            </div>
        </div>
        <div class="col-sm-6 col-md-4">
            <form class="form-horizontal">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">{% trans 'Hvem, hvor og hvornår' %}</h3>
                    </div>
                    <div class="panel-body">
                        <dl class="dl-horizontal">

                            {% if object.get_audience_display %}
                                <dt>{% trans 'Henvendt til'%}:</dt>
                                <dd>{{ object.get_audience_display }}</dd>
                            {% endif %}

                            {% if object.resource_ptr.all_subjects  %}
                                <dt>{% trans 'Fag/niveau' %}:</dt>
                                <dd>
                                    <ul class="type-offer list-inline">
                                        {% for x in object.resource_ptr.all_subjects %}
                                        <li>{{ x.display_value }}</li>
                                        {% endfor %}
                                    </ul>
                                </dd>
                            {% endif %}

                            {% if object.num_of_participants_display %}
                                <dt>{% trans 'Max antal' %}:</dt>
                                <dd>{{ object.num_of_participants_display }}</dd>
                            {% endif %}

                            {% if object.get_type_display %}
                                <dt>{% trans 'Hvad' %}:</dt>
                                <dd>{{ object.get_type_display }}</dd>
                            {% endif %}

                            {% if object.locality %}
                                <dt>{% trans 'Hvor' %}:</dt>
                                <dd>
                                    {{ object.locality.name }},<br/>
                                    {{ object.locality.address_line }},<br/>
                                    {{ object.locality.zip_city }}
                                </dd>
                            {% endif %}

                            <dt>{% trans 'Arrangør:' %}</dt>
                            <dd>
                                {% if object.unit.url %}
                                    <a href="{{ object.unit.url }}" target="_blank">
                                {% endif %}
                                <strong>{{ object.unit.name }}</strong>
                                {% if object.unit.url %}
                                    </a> <span class="glyphicon glyphicon-new-window"></span>
                                {% endif %}
                            </dd>
                            
                            <dt>Hvornår:</dt>
                            <!--<dd>{{ object.time }}</dd>-->
                            <dd>
                                {% for description in object.recurrences_description %}
                                    {{ description }}
                                {% endfor %}
                                <ul class="list-unstyled">
                                {% for occurrence in object.visitoccurrence_set.all %}
                                    <li>{{ occurrence.start_datetime|date:'d-m-Y H:i' }}</li>
                                {% endfor %}
                                </ul>
                            </dd>

                            {% if object.duration %}
                                <dt>{% trans 'Varighed' %}:</dt>
                                <dd>{{ object.duration|timedelta }}</dd>
                            {% endif %}

                            {% if object.price %}
                                <dt>{% trans 'Pris' %}:</dt>
                                <dd>{{ object.price }}</dd>
                            {% endif %}
                        </dl>
                    </div>
                </div>

                {% include 'common/map.html' with locality=object.locality %}

            </form>
        </div>
    </div>

    {% include 'common/modal_contact.html' %}

<!-- Modal start -->
    <div class="modal fade" id="startbooking" tabindex="-1" role="Popup-bookingflow" aria-labelledby="overskrift" data-frametarget="/visit/{{ object.id }}/book">
        <div class="modal-dialog modal-lg" role="Bookingflow">
            <div class="modal-content" id="booking-container"></div>
        </div>
    </div>
    <!-- Modal end -->
{% endblock %}
{% block footer %}
    <div class="container">
        <div class="row">
            <footer>
                <div class="container">
                    <div class="row footer-columns">
                        <div class="col-sm-4 col-sm-offset-0">
                            <ul class="footerlinks">
                                <li><a href="http://kommunikation.ku.dk/">Kommunikation</a></li>
                                <li><a href="http://www.ku.dk/">Københavns Universitet</a></li>
                                <li>Nørregade 10, Postboks 2177</li>
                                <li>1017 København K</li>
                            </ul>
                        </div>
                        <div class="col-sm-4 col-sm-offset-4">
                            <ul class="footerlinks">
                                <li class="clearfix social-icons"><a target="_blank" class="footer-social" href="https://www.facebook.com/universitet"><span class="icon-circle"><i class="fa fa-facebook"></i></span></a><a target="_blank" class="footer-social" href="https://www.linkedin.com/edu/k%C3%B8benhavns-universitet-12012"><span class="icon-circle"><i class="fa fa-linkedin"></i></span></a><a target="_blank" class="footer-social" href="https://twitter.com/koebenhavns_uni"><span class="icon-circle"><i class="fa fa-twitter"></i></span></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script src="/static/js/custom.js"></script>
    <script src="{% static "js/modalframe-host.js" %}"></script>
    <script type="text/javascript">
    <!--
    $('#startbooking').hostModalIframe($('#startbooking').attr("data-frametarget"));
    //-->
    </script>
{% endblock %}
