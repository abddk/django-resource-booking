{% extends 'index.html' %}
{% load staticfiles %}
{% load timedelta %}
{% load i18n %}
{% load booking_tags %}

{% block content %}

    {% include 'common/breadcrumbrow.html' %}

    <div class="row titlebar hidden-print">
        <div class="col-sm-12 col-md-9"><h2>{% trans 'Om tilbuddet' %}</h2></div>
        <div class="divider"></div>
    </div>
    <div class="row">
        <div class="col-sm-12 col-md-8">

            {% include 'common/searchform.html' %}

            <div class="divider"></div>
            <h2>{{ object.get_type_display }}</h2>
            
            {% if can_edit %}
                <a class="pull-right btn btn-primary margin-bottom-10" href="{% url 'visit-edit' object.pk %}">{% trans '+ Redigér' %}</a>
            {% endif %}
            {% if user.userprofile.can_create %}
                <a class="pull-right btn btn-primary margin-bottom-10 margin-right-10" href="{% url 'visit-clone' object.pk %}">{% trans 'Opret kopi' %}</a>
            {% endif %}
            
            <h1>{{ object.title }}</h1>
            <div class="well">
                {% autoescape off %}
                {{ object.teaser }}
                {% endautoescape %}
            </div>
            <div class="well">
                <!-- Richtext editor start -->
                {% autoescape off %}
                {{ object.description }}
                {% endautoescape %}
                <!-- Richtext editor end -->
            </div>
            <div>
                {% if messages %}
                <ul class="messages errorlist">
                    {% for message in messages %}
                    <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% if object.studymaterial_set %}
                <ul>
                {% for material in object.studymaterial_set.all %}
                    <li>
                        <a href="{{ MEDIA_URL }}{{ material.file.url }}">{{ material.file.name | upload_name_strip_path }} ({{ material.file.size | filesizeformat }})</a>
                    </li>
                {% endfor %}
                </ul>
            {% endif %}
            <div class="well order-buttons hidden-print">
                {% if can_book %}
                <a class="btn btn-default" data-toggle="modal" data-target="#modalhost" data-modal-href="{% url 'visit-book' object.id %}">
                    {% trans 'Tilmeld' %}
                    <span class="glyphicon glyphicon-chevron-right"></span>
                </a>
                {% endif %}
                {% if object.unit.contact %}
                    <a href="{% url 'email' object.unit.contact.id %}?back={{ thisurl | urlencode }}" class="btn btn-default">
                        {% trans 'Spørg om tilbud' %}
                        <span class="glyphicon glyphicon-question-sign"></span>
                    </a>
                {% endif %}
            </div>
            {% if can_book %}
                <div class="disclaimer">{% trans 'Bemærk at din bestilling først er bindende, når du har modtaget en bekræftelse fra den ansvarlige arrangør fra Københavns Universitet.' %}</div>
            {% endif %}
            <div class="go-back">
                <a href="#" class="btn btn-default" onclick="history.go(-1); return false;"><span class="glyphicon glyphicon-chevron-left"></span> {% trans 'Tilbage til søgeresultat' %}</a>
            </div>
        </div>
        <div class="col-sm-6 col-md-4">
            <form class="form-horizontal">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">{% trans 'Hvem, hvor og hvornår' %}</h3>
                    </div>
                    <div class="panel-body">
                        <dl class="dl-horizontal">

                            {% if object.get_audience_display %}
                                <dt>{% trans 'Henvendt til'%}:</dt>
                                <dd>{{ object.get_audience_display }}</dd>
                            {% endif %}
                            
                            {% if object.resource_ptr.all_subjects  %}
                                <dt>{% trans 'Fag/niveau' %}:</dt>
                                <dd>
                                    <ul class="type-offer list-inline">
                                        {% for x in object.resource_ptr.all_subjects %}
                                        <li>{{ x.display_value }}</li>
                                        {% endfor %}
                                    </ul>
                                </dd>
                            {% endif %}
                            
                            {% if object.num_of_participants_display %}
                                <dt>{% trans 'Antal' %}:</dt>
                                <dd>{{ object.num_of_participants_display }}</dd>
                            {% endif %}
                            
                            {% if object.get_type_display %}
                                <dt>{% trans 'Hvad' %}:</dt>
                                <dd>{{ object.get_type_display }}</dd>
                            {% endif %}
                            
                            {% if object.locality %}
                                <dt>{% trans 'Hvor' %}:</dt>
                                <dd>
                                    {{ object.locality.name }}<br>
                                    {{ object.locality.address_line }}<br>
                                    {{ object.locality.zip_city }}
                                </dd>
                            {% endif %}
                            
                            <dt>{% trans 'Arrangør' %}:</dt>
                            <dd>
                                {% if object.unit.url %}
                                    <a href="{{ object.unit.url }}" target="_blank">
                                {% endif %}
                                <strong>{{ object.unit.name }}</strong>
                                {% if object.unit.url %}
                                    </a> <span class="glyphicon glyphicon-new-window"></span>
                                {% endif %}
                            </dd>
                            
                            {% if request.user.userprofile.can_create %}
                                {% if object.visitoccurrence_set.all %}
                                <dt>Hvornår:</dt>
                                <dd>
                                    <ul class="list-unstyled" id="dato">
                                    {% for event in object.visitoccurrence_set.all %}
                                        <li><a href="{% url 'visit-occ-view' event.pk %}">{{ event.start_datetime|date:'d-m-Y H:i' }}{% if event.expired %} (udløbet){% endif %}</a></li>
                                    {% endfor %}
                                    </ul>
                                </dd>
                                {% endif %}
                            {% else %}
                                {% if object.future_events %}
                                <dt>Hvornår:</dt>
                                <dd>
                                    <ul class="list-unstyled" id="dato">
                                    {% for event in object.future_events %}
                                        <li>{{ event.start_datetime|date:'d-m-Y H:i' }}</li>
                                    {% endfor %}
                                    </ul>
                                </dd>
                                {% endif %}
                            {% endif %}

                            {% if object.duration %}
                                <dt>{% trans 'Varighed' %}:</dt>
                                <dd>{{ object.duration|timedelta }}</dd>
                            {% endif %}
                            
                            {% if object.price %}
                                <dt>{% trans 'Pris' %}:</dt>
                                <dd>{{ object.price }}</dd>
                            {% endif %}
                            
                        </dl>
                    </div>
                </div>

                {% include 'common/map.html' with locality=object.locality %}

            </form>
        </div>
    </div>

    {% include 'common/modal_contact.html' %}
    
    {% include 'common/modal_framehost.html' %}

{% endblock %}

{% block footer %}
    
    <div class="container">
        <div class="row">
            <footer>
                <div class="container">
                    <div class="row footer-columns">
                        <div class="col-sm-4 col-sm-offset-0">
                            <ul class="footerlinks">
                                <li><a href="http://kommunikation.ku.dk/">Kommunikation</a></li>
                                <li><a href="http://www.ku.dk/">Københavns Universitet</a></li>
                                <li>Nørregade 10, Postboks 2177</li>
                                <li>1017 København K</li>
                            </ul>
                        </div>
                        <div class="col-sm-4 col-sm-offset-4">
                            <ul class="footerlinks">
                                <li class="clearfix social-icons"><a target="_blank" class="footer-social" href="https://www.facebook.com/universitet"><span class="icon-circle"><i class="fa fa-facebook"></i></span></a><a target="_blank" class="footer-social" href="https://www.linkedin.com/edu/k%C3%B8benhavns-universitet-12012"><span class="icon-circle"><i class="fa fa-linkedin"></i></span></a><a target="_blank" class="footer-social" href="https://twitter.com/koebenhavns_uni"><span class="icon-circle"><i class="fa fa-twitter"></i></span></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

{% endblock %}

{% block extra_scripts %}

    <script src="/static/js/custom.js"></script>
    <script src="{% static "js/modalframe-host.js" %}"></script>

{% endblock %}
